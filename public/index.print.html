<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.121.0">
    <meta name="generator" content="Relearn 6.0.0+tip">
    <meta name="description" content="A theme for Hugo designed for documentation.">
    <meta name="author" content="Zhixia Xiao">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Hugo Relearn Theme :: StarScope">
    <meta name="twitter:description" content="A theme for Hugo designed for documentation.">
    <meta property="og:url" content="/index.html">
    <meta property="og:site_name" content="StarScope">
    <meta property="og:title" content="Hugo Relearn Theme :: StarScope">
    <meta property="og:description" content="A theme for Hugo designed for documentation.">
    <meta property="og:locale" content="en-us">
    <meta property="og:type" content="website">
    <meta itemprop="name" content="Hugo Relearn Theme :: StarScope">
    <meta itemprop="description" content="A theme for Hugo designed for documentation.">
    <meta itemprop="wordCount" content="2620">
    <title>Hugo Relearn Theme :: StarScope</title>
    <link href="./index.html" rel="canonical" type="text/html" title="Hugo Relearn Theme :: StarScope">
    <link href="./index.xml" rel="alternate" type="application/rss+xml" title="Hugo Relearn Theme :: StarScope">
    <link href="./images/logo.svg?1714963182" rel="icon" type="image/svg+xml">
    <link href="./css/fontawesome-all.min.css?1714963182" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/fontawesome-all.min.css?1714963182" rel="stylesheet"></noscript>
    <link href="./css/nucleus.css?1714963182" rel="stylesheet">
    <link href="./css/auto-complete.css?1714963182" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/auto-complete.css?1714963182" rel="stylesheet"></noscript>
    <link href="./css/perfect-scrollbar.min.css?1714963182" rel="stylesheet">
    <link href="./css/fonts.css?1714963182" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="./css/fonts.css?1714963182" rel="stylesheet"></noscript>
    <link href="./css/theme.css?1714963182" rel="stylesheet">
    <link href="./css/theme-blue.css?1714963182" rel="stylesheet" id="R-variant-style">
    <link href="./css/chroma-learn.css?1714963182" rel="stylesheet" id="R-variant-chroma-style">
    <link href="./css/variant.css?1714963182" rel="stylesheet">
    <link href="./css/print.css?1714963182" rel="stylesheet" media="print">
    <link href="./css/format-print.css?1714963182" rel="stylesheet">
    <script src="./js/variant.js?1714963182"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='.';
      window.relearn.relBaseUri='.';
      window.relearn.absBaseUri='';
      window.index_js_url="./index.search.js";
      // variant stuff
      window.variants && variants.init( [ 'blue' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
    <style>
      #R-body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="./index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList">
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><span class="topbar-control"><i class="fa-fw fas fa-chevron-left"></i></span>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="./basics/index.html" title="Basics (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable home" tabindex="-1">
        <div class="flex-block-wrapper">
          <article class="home">
            <header class="headline">
            </header>

<h1 id="hugo-relearn-theme">Hugo Relearn Theme</h1>

<div class="include hide-first-heading">
<h1 id="starscope">StarScope</h1>
<p><code>StarScope</code> provide a convenient way to run the
<a href="https://github.com/obenno/scRNA-seq" rel="external" target="_self">scRNA-seq workflow</a>
which uses <strong>starsolo</strong> (<a href="https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md" rel="external" target="_self">https://github.com/alexdobin/STAR/blob/master/docs/STARsolo.md</a>)
and <strong>Seurat</strong> package (<a href="https://satijalab.org/seurat/" rel="external" target="_self">https://satijalab.org/seurat/</a>) as the core modules to process scRNA-seq
data and generate a concise HTML report.
The workflow was implemented by <a href="https://www.nextflow.io/" rel="external" target="_self"><strong>nextflow</strong></a>.</p>
<h2 id="quick-start-with-thunderbio-example-data">Quick Start with ThunderBio Example Data</h2>
<p>ThunderBio will provide human and mouse pre-built reference and two sets example data upon request.
The <code>demo_data</code> fold contains two directories, human and mouse. In each directory, user could invoke
the pipeline by running command below. Please note the reference index has to be placed in the
same parent folder of the <code>demo_data</code>.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>## Human Data Testing with conda or docker
cd demo_data/human
starscope run --input sampleList.csv --config thunderbio_human_conda.config
starscope run --input sampleList.csv --config thunderbio_human_docker.config</code></pre></div><div class="highlight wrap-code"><pre tabindex="0"><code>## Mouse Data Testing with conda or docekr
cd demo_data/mouse</code></pre></div><div class="highlight wrap-code"><pre tabindex="0"><code>demo_data/
â”œâ”€â”€ human
â”‚Â Â  â”œâ”€â”€ human_test.R1.fq.gz
â”‚Â Â  â”œâ”€â”€ human_test.R2.fq.gz
â”‚Â Â  â”œâ”€â”€ sampleList.csv
â”‚Â Â  â”œâ”€â”€ thunderbio_human_conda.config
â”‚Â Â  â””â”€â”€ thunderbio_human_docker.config
â”œâ”€â”€ mouse
â”‚Â Â  â”œâ”€â”€ mouse_test.R1.fq.gz
â”‚Â Â  â”œâ”€â”€ mouse_test.R2.fq.gz
â”‚Â Â  â”œâ”€â”€ sampleList.csv
â”‚Â Â  â”œâ”€â”€ thunderbio_mouse_conda.config
â”‚Â Â  â””â”€â”€ thunderbio_mouse_docker.config
â””â”€â”€ V2_barcode_seq_210407_concat.txt</code></pre></div><h2 id="installation">Installation</h2>
<h3 id="dependencies">Dependencies</h3>
<ul>
<li>Java 11 or higher</li>
<li>Nextflow</li>
<li>Conda/Miniconda</li>
<li>or Docker Engine</li>
</ul>
<p><code>StarScope</code> will automatically check dependencies, install nextflow and
create conda environment if conda is selected as running environment.
But user will have to install <a href="https://openjdk.java.net/install/" rel="external" target="_self"><code>Java</code></a> and
<a href="https://docs.conda.io/en/latest/miniconda.html" rel="external" target="_self"><code>Miniconda</code></a>
manually. It is suggested to install
<a href="https://mamba.readthedocs.io/en/latest/installation.html" rel="external" target="_self"><code>mamba</code></a>
via <code>conda install -n base -c conda-forge mamba</code> to speedup environment
initiation process. By default, the nextflow binary will be downloaded in the working directory, user could move it to $PATH.
Alternatively, user could use docker container as running environment. But <code>docker</code> has to be installed on the system:</p>
<h4 id="java">Java</h4>
<p>StarScope was tested with both openJDK and oracle Java SE version.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>## download link may vary depending on java version
wget -c https://download.java.net/java/GA/jdk17.0.2/dfd4a8d0985749f896bed50d7138ee7f/8/GPL/openjdk-17.0.2_linux-x64_bin.tar.gz
## Java SE version
## wget -c https://download.oracle.com/java/17/latest/jdk-17_linux-x64_bin.tar.gz
tar xvzf openjdk-17.0.2_linux-x64_bin.tar.gz
## set environment variable
export JAVA_HOME=&#34;$(pwd)/jdk-17.0.2&#34;
export PATH=&#34;$(pwd)/jdk-17.0.2/bin:$PATH&#34;
## it is suggested to add export cmd above to your .bashrc</code></pre></div><h4 id="conda">Conda</h4>
<p>Please use the corresponding installation script for your processor architecture.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>wget -c https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh</code></pre></div><p><code>starscope</code> will create conda environment automatically when invoking <code>run</code> subcommand
first time with the <code>--conda</code> option. User could create the environment
manually before running.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>conda env create -f starscope/scRNA-seq/scRNAseq_env.yml</code></pre></div><h4 id="docker">Docker</h4>
<div class="highlight wrap-code"><pre tabindex="0"><code>curl -fsSL https://get.docker.com -o get-docker.sh
sh get-docker.sh</code></pre></div><p>To use docker command without <code>sudo</code>, add account to <code>docker</code> group:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>sudo usermod -aG docker $(whoami)</code></pre></div><p>Then login out and login again for the changes to take effect.</p>
<p><code>starscope</code> will pull the image automatically when invoke commands. If the network is not stable, user could pull the image manually with:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>docker pull registry-intl.cn-hangzhou.aliyuncs.com/thunderbio/thunderbio_scrnaseq_env:2.7.10a</code></pre></div><h4 id="nextflow">Nextflow</h4>
<p>Download <code>nextflow</code> with:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>curl -s https://get.nextflow.io | bash</code></pre></div><p>Then mv the executable to <code>$PATH</code> (e.g. ~/.local/bin)</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>mv ./nextflow ~/.local/bin/</code></pre></div><p>Confirm that nextflow runs properly</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>NXF_VER=22.04.5 nextflow run hello</code></pre></div><p>The output will be:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>N E X T F L O W ~ version 22.04.5
Launching `https://github.com/nextflow-io/hello` [distraught_ride] DSL2
- revision: 4eab81bd42 [master]
executor &gt; local (4)
[92/5fbfca] process &gt; sayHello (4) [100%] 4 of 4 âœ”
Bonjour world!

Hello world!

Ciao world!

Hola world!</code></pre></div><h4 id="get-code">Get Code</h4>
<p>Clone the repository from github:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>git clone --recurse-submodules https://github.com/obenno/StarScope.git</code></pre></div><p>User could add <code>starscope</code> to PATH via creating
symbolic link (assuming <code>~/.local/bin</code> is in the $PATH):</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>ln -s /git/repo/starscope ~/.local/bin/</code></pre></div><h2 id="prepare-star-reference">Prepare STAR reference</h2>
<p>User could use their own genome FASTA and GTF file to create STAR reference by invoking <code>starscope mkref</code> command. Example below used Zebrafish genome files as input.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1">## Zebrafish genome files are from Ensembl release 107</span>
</span></span><span class="line"><span class="cl"><span class="c1">## https://uswest.ensembl.org/Danio_rerio/Info/Index</span>
</span></span><span class="line"><span class="cl"><span class="c1">## Download genome FASTA file</span>
</span></span><span class="line"><span class="cl">wget -c http://ftp.ensembl.org/pub/release-107/fasta/danio_rerio/dna/Danio_rerio.GRCz11.dna.primary_assembly.fa.gz
</span></span><span class="line"><span class="cl"><span class="c1">## Download GTF file</span>
</span></span><span class="line"><span class="cl">wget -c http://ftp.ensembl.org/pub/release-107/gtf/danio_rerio/Danio_rerio.GRCz11.107.gtf.gz</span></span></code></pre></div><p><code>mkref</code> command:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">starscope mkref --docker <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                --genomeFasta Danio_rerio.GRCz11.dna.primary_assembly.fa <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                --gtf Danio_rerio.GRCz11.107.gtf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                --refoutDir Danio_rerio.GRCz11.107_STAR</span></span></code></pre></div><p>We included a bash script for user to generate 10x compatible reference. 10x has removed some genes
from the standard genecode annotation. Please refer to their
<a href="https://support.10xgenomics.com/single-cell-gene-expression/software/release-notes/build#header" rel="external" target="_self">website</a>
for detail process procedures.</p>
<p>To generate human reference with conda, use command below:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>prepare_10x_compatible_reference.sh human --cpus 8 --mem 32.GB -bg</code></pre></div><p>user could use <code>prepare_10x_compatible_reference.sh -h</code> to get the full help:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>prepare_10x_compatible_reference.sh will help you to generate
10x cellranger compatible STAR reference set. The detail preparing
procedures could be referred from 10x&#39;s documentation website:
https://support.10xgenomics.com/single-cell-gene-expression/software/release-notes/build#header

Usage:
prepare_10x_compatible_reference.sh &lt;human|mouse|hm|all&gt; [starscope_options]

prepare_10x_compatible_reference.sh human    generate human GRh38 reference
prepare_10x_compatible_reference.sh mouse    generate mouse mm10 reference
prepare_10x_compatible_reference.sh hm       combine GRh38 and mm10 to
                                             generate reference for hybrid
                                             sample analysis
prepare_10x_compatible_reference.sh all      generate all three reference
                                             datasets mentioned above

starscope_options:
--executor        Define executor of nextflow (local), see:
                  https://www.nextflow.io/docs/latest/executor.html
--cpus            CPUs to use for all processes (8)
--mem             Memory to use for all processes, please note
                  the special format (16.GB)
--noDepCheck      Do not check Java and nextflow before
                  running (false)
-bg               Running the pipeline in background (false)

example:
prepare_10x_compatible_reference.sh human --cpus 8 --mem 32.GB -bg</code></pre></div><h2 id="usage">Usage</h2>
<p>Please note the whitelist files have to be decompressed before passing to the program.
To run ThunderBio dataset, decompress with <code>gunzip whitelist/V2_barcode_seq_210407_concat.txt.gz</code>
and use the <code>/path/to/V2_barcode_seq_210407_concat.txt</code> as the whitelist file in <code>starscope run</code> command.</p>
<p>Please also note <code>--mem</code> option of <code>run</code> command needs a special format: e.g. <code>32.GB</code>.</p>
<p>Please note user could use <code>-bg</code> to run the command in the background, and <code>--executor slurm</code> will submit the jobs to HPC <code>slurm</code> job scheduler.</p>
<h3 id="example-sample-list">Example sample list</h3>
<p>The workflow takes a csv format sample list as input, which is the <code>sampleList.csv</code>
in the command above. The sample list file only contains three
column: <code>sample</code>, <code>fastq_1</code>, <code>fastq_2</code>. User only needs to specify sample name,
path of read1 and read2. The program will assume that read1 file is the one
containing barcode and UMI information. Both absolute and relative path are supported.
If the library has multiple runs (i.e. multiple files of R1 and R2), user could indicate the path of those files with identical sample name, and they will be <code>cat</code> into one
in the analysis.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>sample,fastq_1,fastq_2
sampleID,read1.fq.gz,/absolute/path/to/read2.fq.gz</code></pre></div><p>For GEX+VDJ analysis, <code>sampleList.csv</code> will require an additional column <code>feature_types</code>.</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>sample,fastq_1,fastq_2,feature_types
vdj_sample1,gex_R1.fq.gz,gex_R2.fq.gz,GEX
vdj_sample1,vdj_t_R1.fq.gz,vdj_t_R2.fq.gz,VDJ-T
vdj_sample1,vdj_b_R1.fq.gz,vdj_b_R2.fq.gz,VDJ-B</code></pre></div><h3 id="example-command">Example command</h3>
<h4 id="create-star-reference-index">Create STAR reference index</h4>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope mkref --conda \
                --genomeFasta /path/to/genome/fasta \
                --genomeGTF /path/to/genome/gtf \
                --refoutDir reference_out_dir </code></pre></div><h4 id="thunderbio-3-scrna-seq">ThunderBio 3&rsquo;-scRNA-seq</h4>
<p>Run thunderbio 3&rsquo;-scRNA-seq data with conda env:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope run --conda \
              --input sampleList.csv \
              --genomeDir /path/to/STAR/reference/dir \
              --genomeGTF /path/to/genomeGTF \
              --whitelist /path/to/whitelist \
              --trimLength 50 \
              --soloCBstart 1 \
              --soloCBlen 29 \
              --soloUMIstart 30 \
              --soloUMIlen 10 </code></pre></div><h4 id="thunderbio-5-scrna-seq">ThunderBio 5&rsquo;-scRNA-seq</h4>
<p>Run thunderbio 5&rsquo;-scRNA-seq data with conda env:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope run --conda \
              --input sampleList.csv \
              --genomeDir /path/to/STAR/reference/dir \
              --genomeGTF /path/to/genomeGTF \
              --whitelist /path/to/whitelist \
              --trimLength 50 \
              --soloCBstart 1 \
              --soloCBlen 29 \
              --soloUMIstart 30 \
              --soloUMIlen 10 \
              --soloStrand Reverse</code></pre></div><h4 id="thunderbio-gexvdj">ThunderBio GEX+VDJ</h4>
<p>Run thunderbio 5&rsquo;-scRNA-seq together with single cell VDJ libraries:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope vdj_gex --conda \
                  --input sampleList.csv \
                  --genomeDir /path/to/STAR/reference/dir \
                  --genomeGTF /path/to/genomeGTF \
                  --whitelist /path/to/whitelist \
                  --trust4_vdj_refGenome_fasta /path/to/refGenome_vdj_fasta \
                  --trust4_vdj_imgt_fasta /path/to/imgt_vdj_fasta \
                  --trimLength 28 \
                  --soloCBstart 1 \
                  --soloCBlen 29 \
                  --soloUMIstart 30 \
                  --soloUMIlen 10 \</code></pre></div><p>The pre-built vdj reference fasta file for trust4 was also included in <code>starscope/scRNA-seq/vdj/reference</code>.</p>
<p>For human hg38:</p>
<ul>
<li>
<p><code>trust4_vdj_refGenome_fasta</code> : <code>starscope/scRNA-seq/vdj/reference/hg38_bcrtcr.fa</code></p>
</li>
<li>
<p><code>trust4_vdj_imgt_fasta</code> : <code>starscope/scRNA-seq/vdj/reference/human_IMGT+C.fa</code></p>
</li>
</ul>
<p>For mouse mm10:</p>
<ul>
<li>
<p><code>trust4_vdj_refGenome_fasta</code> : <code>starscope/scRNA-seq/vdj/reference/GRCm38_bcrtcr.fa</code></p>
</li>
<li>
<p><code>trust4_vdj_imgt_fasta</code> : <code>starscope/scRNA-seq/vdj/reference/mouse_IMGT+C.fa</code></p>
</li>
</ul>
<h3 id="resources">Resources</h3>
<p>Please ensure that you have enough resource for <code>StarScope</code>:</p>
<ul>
<li>
<p>Human GRh38 genome needs at least 32GB memory</p>
</li>
<li>
<p>Hybrid sample (human and mouse cells) may need 50-60GB memory</p>
</li>
</ul>
<h3 id="main-program">Main program</h3>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope uses starsolo and Seurat package as the core modules to process
scRNA-seq data and generate a concise html report. The workflow was
implemented by nextflow.

Running pipeline:
starscope &lt;run&gt; --conda \
                --input sampleList.csv \
                --genomeDir /path/to/STAR/reference/dir \
                --genomeGTF /path/to/genomeGTF \
                --whitelist /path/to/whitelist \
                --trimLength 28 \
                --soloCBstart 1 \
                --soloCBlen 29 \
                --soloUMIstart 30 \
                --soloUMIlen 10 \
                -bg

Example input list (csv):
sample,fastq_1,fastq_2
sampleName,read1.fq.gz,/absolute/path/to/read2.fq.gz

Making Reference:
starscope &lt;mkref&gt; --conda \
                  --genomeFasta /path/to/genome/fasta \
                  --genomeGTF /path/to/genome/gtf \
                  --refoutDir reference_out_dir \
                  -bg

starscope has four valid subcommands:
    run:            run the scRNAseq analysis pipeline with nextflow
    mkref:          prepare STAR reference
    vdj_gex:        perform vdj+gex analysis
    check_version:  check software versions

Please use -h option following each subcommand to get detail
of the options: e.g. starscope run -h</code></pre></div><h3 id="run-command"><code>run</code> command</h3>
<div class="highlight wrap-code"><pre tabindex="0"><code>Basic Usage:
============
starscope &lt;run&gt; --conda \
                --input sampleList.csv \
                --genomeDir /path/to/STAR/reference \
                --genomeGTF /path/to/genomeGTF \
                --whitelist /path/to/whitelist \
                --trimLength 28 \
                --soloCBstart 1 \
                --soloCBlen 29 \
                --soloUMIstart 30 \
                --soloUMIlen 10 \
                -bg

options:
  --conda               Use conda env to run (true)
  --docker              Use docker container to run
  --input               Input sample list, csv format, required
                        columns include &#34;sample&#34; for sampleName,
                        &#34;fastq_1&#34; for read1, &#34;fastq_2&#34; for read2,
                        and read1 is assumed to contain cell
                        barcode.
  --genomeDir           Path of STAR reference directory
  --genomeGTF           Path of reference genome GTF file
  --whitelist           Path of whitelist of barcodes
  --trimLength          Min read length retained after cutadapt
                        trimming (28)
  --soloCBstart         Cell barcode start base in read1 (1)
  --soloCBlen           Cell barcode length (29)
  --soloUMIstart        UMI start base in read1 (30)
  --soloUMIlen          UMI length (10)
  --soloFeatures        Define whether only count UMI in exon region:
                        Gene or GeneFull which includes both exon and
                        intron reads (GeneFull)
  --soloMultiMappers    Counting method for reads mapping to multiple genes:
                        Unique or EM (Unique)
  --soloStrand          Library strandness, Forward for thunderbio
                        3&#39; RNA-seq, Reverse for 5&#39; RNA-seq (Forward)
  --config              Provide a custom nextflow config file to
                        define all parameters
  --executor            Define executor of nextflow (local), see:
                        https://www.nextflow.io/docs/latest/executor.html
  --cpus                CPUs to use for all processes (8)
  --mem                 Memory to use for all processes, please note
                        the special format (32.GB)
  --noDepCheck          Do not check Java and nextflow before
                        running (false)
  -bg                   Running the pipeline in background (false)</code></pre></div><h3 id="mkref-command"><code>mkref</code> command</h3>
<div class="highlight wrap-code"><pre tabindex="0"><code>Basic Usage:
===========
starscope &lt;mkref&gt; --conda \
                  --genomeFasta /path/to/genome/fasta \
                  --genomeGTF /path/to/genome/gtf \
                  --refoutDir reference_out_dir \
                  -bg

options:
  --conda           Use conda env to run (true)
  --genomeFasta     Path of reference FASTA file
  --genomeGTF       Path of reference GTF file
  --config          Provide a custom nextflow config file to
                    define all parameters
  --executor        Define executor of nextflow (local), see:
                    https://www.nextflow.io/docs/latest/executor.html
  --cpus            CPUs to use for all processes (8)
  --mem             Memory to use for all processes, please note
                    the special format (16.GB)
  --noDepCheck      Do not check Java and nextflow before
                    running (false)
  -bg               Running the pipeline in background (false)</code></pre></div><h3 id="vdj_gex-command"><code>vdj_gex</code> command</h3>
<div class="highlight wrap-code"><pre tabindex="0"><code>Basic Usage:
===========
Example sampleList.csv:
sample,fastq_1,fastq_2,feature_types
vdj_sample1,gex.R1.fq.gz,gex.R2.fq.gz,GEX
vdj_sample1,t.R1.fq.gz,t.R2.fq.gz,VDJ-T
vdj_sample1,b.R1.fq.gz,b.R2.fq.gz,VDJ-B

starscope &lt;vdj_gex&gt; --conda \
                    --input sampleList.csv \
                    --genomeDir /path/to/STAR/reference/dir \
                    --genomeGTF /path/to/genomeGTF \
                    --whitelist /path/to/whitelist \
                    --trust4_vdj_refGenome_fasta /path/to/refGenome_vdj_fasta \
                    --trust4_vdj_imgt_fasta /path/to/imgt_vdj_fasta \
                    --trimLength 28 \
                    --soloCBstart 1 \
                    --soloCBlen 29 \
                    --soloUMIstart 30 \
                    --soloUMIlen 10 \

options:
  --conda               Use conda env to run (true)
  --docker              Use docker container to run
  --input               Input sample list, csv format, required
                        columns include &#34;sample&#34; for sampleName,
                        &#34;fastq_1&#34; for read1, &#34;fastq_2&#34; for read2,
                            &#34;feature_types&#34; for library type
                            (GEX/VDJ-T/VDJ-B), and read1 is assumed
                            to contain cell barcode.
  --genomeDir           Path of STAR reference directory
  --genomeGTF           Path of reference genome GTF file
  --whitelist           Path of whitelist of barcodes
  --trimLength          Min read length retained after cutadapt
                        trimming (28)
  --soloCBstart         Cell barcode start base in read1 (1)
  --soloCBlen           Cell barcode length (29)
  --soloUMIstart        UMI start base in read1 (30)
  --soloUMIlen          UMI length (10)
  --soloFeatures        Define whether only count UMI in exon region:
                        Gene or GeneFull which includes both exon and
                        intron reads (GeneFull)
  --soloMultiMappers    Counting method for reads mapping to multiple genes:
                        Unique or EM (Unique)
  --config              Provide a custom nextflow config file to
                        define all parameters
  --executor            Define executor of nextflow (local), see:
                        https://www.nextflow.io/docs/latest/executor.html
  --cpus                CPUs to use for all processes (8)
  --mem                 Memory to use for all processes, please note
                        the special format (32.GB)
  --noDepCheck          Do not check Java and nextflow before
                        running (false)
  -bg                   Running the pipeline in background (false)</code></pre></div><h3 id="check_version-command"><code>check_version</code> command</h3>
<div class="highlight wrap-code"><pre tabindex="0"><code>Basic Usage:
===========
starscope &lt;check_version&gt; [--conda|--docker]

options:
  --conda     print program version of conda env
  --docker    print program version in docker container</code></pre></div><h2 id="advance-usage">Advance Usage</h2>
<p>User could use a local config file and submit jobs to job scheduler on HPC (e.g. <code>slurm</code>):</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>starscope run --input sampleList.csv --config local.config -bg</code></pre></div><p>Example config for thunderbio 3&rsquo; scRNA-seq data:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>params {
  genomeDir = &#34;/path/to/STAR/reference/&#34;
  genomeGTF = &#34;/path/to/reference/genes.gtf&#34;
  whitelist = &#34;/path/to/whitelist&#34;
  trimLength = 50
  soloCBstart = 1
  soloCBlen = 29
  soloUMIstart = 30
  soloUMIlen = 10
  soloMultiMappers = &#34;Unique&#34;
  enable_conda = true
}

process {
  //executor = &#34;slurm&#34; // uncomment this line to submit jobs to slurm job scheduler
  conda = &#34;/path/to/miniconda3/envs/starscope_env&#34;
  // adjust resources here
  withLabel: process_high {
    cpus = 8
    memory = 32.GB
  }
  withLabel: process_medium {
    cpus = 4
    memory = 20.GB
  }
  withLabel: process_low {
    cpus = 4
    memory = 20.GB
  }
  withName: REPORT {
    // adjust report memory config according to dataset size
    memory = 40.GB
  }
}</code></pre></div><p>For docker container, please use the config below:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>params {
  genomeDir = &#34;/path/to/STAR/reference/&#34;
  genomeGTF = &#34;/path/to/reference/genes.gtf&#34;
  whitelist = &#34;/path/to/whitelist&#34;
  trimLength = 50
  soloCBstart = 1
  soloCBlen = 29
  soloUMIstart = 30
  soloUMIlen = 10
  soloMultiMappers = &#34;Unique&#34;
}

process {
  //executor = &#39;slurm&#39; // uncomment this line to submit jobs to slurm job scheduler
  container = &#34;registry-intl.cn-hangzhou.aliyuncs.com/thunderbio/thunderbio_scrnaseq_env:2.7.10a&#34;
  withLabel: process_high {
    cpus = 8
    memory = 32.GB
  }
  withLabel: process_medium {
    cpus = 4
    memory = 20.GB
  }
  withLabel: process_low {
    cpus = 4
    memory = 20.GB
  }
  withName: REPORT {
    // adjust report memory config according to dataset size
    memory = 40.GB
  }
}

docker.enabled = true
docker.userEmulation = true
docker.runOptions = &#39;-u $(id -u):$(id -g) --init&#39;</code></pre></div><p>All parameters could be found in the <code>starscope/scRNA-seq/nextflow.config</code> file.</p>
<h2 id="output">Output</h2>
<ul>
<li>
<p><strong>results</strong>: main output directory</p>
<ul>
<li><strong>pipeline_info</strong>: store plain text execution_trace file</li>
<li><strong>cutqc</strong>: store cutadapt trimming report generated by customized R markdown script</li>
<li><strong>starsolo</strong>: store <code>starsolo</code> output files, including barcode/UMI matrix, summary files etc.</li>
<li><strong>qualimap</strong>: store <code>qualimap</code> report</li>
<li><strong>report</strong>: contain main HTML report files</li>
</ul>
</li>
<li>
<p><strong>work</strong>: intermediate directory, could be safely removed after running complete</p>
</li>
</ul>
<h2 id="issues">Issues</h2>
<p>Please note that <code>StarScope</code> only supports one sample (library) each sampleList for now.</p>
<h2 id="release-note">Release Note</h2>
<h3 id="starscope-v114">StarScope v1.1.4</h3>
<ul>
<li>
<p>Updated script for saturation calculation, and included UMI and gene hist data for <code>{preseqR}</code> prediction</p>
</li>
<li>
<p>Now a tsv summary file will be outputted in the report process</p>
</li>
</ul>
<h3 id="starscope-v113">StarScope v1.1.3</h3>
<ul>
<li>Added <code>--outBAMsortingBinsN 300</code> option to STARsolo process to solve the RAM issue when sorting a very large BAM file, refer to <a href="https://github.com/alexdobin/STAR/issues/870" rel="external" target="_self">STAR #870</a></li>
</ul>
<h3 id="starscope-v112">StarScope v1.1.2</h3>
<ul>
<li>
<p>Use soft link instead of cat when there is only one fastq file</p>
</li>
<li>
<p>Added support for VDJ subworkflow to only analyze BCR or TCR dataset</p>
</li>
<li>
<p>Added support for publishing saturation json file</p>
</li>
</ul>
<h3 id="starscope-v111">StarScope v1.1.1</h3>
<ul>
<li>
<p>Honer the memory option in the report process</p>
</li>
<li>
<p>Added option for publishing starsolo BAM output</p>
</li>
<li>
<p>Added option to enable conda env for nextflow 22.10, and the nextflow version was fixed to 22.04</p>
</li>
</ul>
<h3 id="starscope-v110">StarScope v1.1.0</h3>
<ul>
<li>
<p>Added VDJ workflow (GEX+VDJ)</p>
</li>
<li>
<p>Removed time limit for process resources</p>
</li>
<li>
<p>Modified the margin of the tables in the 3&rsquo;-scRNA-Seq report</p>
</li>
<li>
<p>Adjusted knee plot to fixed size and center positioned</p>
</li>
</ul>
<h3 id="starscope-v100">StarScope v1.0.0</h3>
<ul>
<li>
<p>Added pipeline running information to the reports</p>
</li>
<li>
<p>Fixed issue for saturation calculation script when there is no whitelist provided</p>
</li>
<li>
<p>Output a full list of DEGs</p>
</li>
</ul>
<h3 id="starscope-v009">StarScope v0.0.9</h3>
<ul>
<li>
<p>Updated STAR to v2.7.10a in both the docker image and the conda environment</p>
</li>
<li>
<p>Adapt the pipeline to generate report for starsolo <code>--soloMultiMappers</code> option, only &ldquo;Unique&rdquo; and &ldquo;EM&rdquo; are supported by now.</p>
</li>
<li>
<p>Changed the default parameter for <code>--soloFeatures</code> to &ldquo;GeneFull&rdquo;, which includes both exon and <strong>intron</strong> reads</p>
</li>
</ul>
<h3 id="starscope-v008">StarScope v0.0.8</h3>
<ul>
<li>
<p>Fixed the issue that RunPCA uses up all cores and consumes too much memory (<a href="https://github.com/satijalab/seurat/issues/3991" rel="external" target="_self">Seurat #3991</a>)</p>
</li>
<li>
<p>Changed h5file format to H5Seurat</p>
</li>
<li>
<p>Disabled sass cache in rmd report</p>
</li>
<li>
<p>Changed future package strategy to multisession to avoid fork errors</p>
</li>
</ul>
<h3 id="starscope-v007">StarScope v0.0.7</h3>
<ul>
<li>
<p><strong>Raw gene/barcode count table will be stored in a loom file and published for subsequent analysis</strong></p>
</li>
<li>
<p><strong>Mapping metrics will be written to a json file</strong></p>
</li>
<li>
<p><strong>Added support for 5&rsquo; RNA-seq library</strong></p>
</li>
</ul>
<h3 id="starscope-v006">StarScope v0.0.6</h3>
<ul>
<li>
<p><strong>Now the BAM output will not by published</strong></p>
</li>
<li>
<p><strong>Added support for counting intron reads</strong></p>
</li>
<li>
<p>Added <code>check_version</code> command, to print all software versions including docker or conda engine information</p>
</li>
<li>
<p>Fixed STAR to 2.7.9a and samtools to 1.15</p>
</li>
<li>
<p>Fixed issue that no report generated if too few cells detected</p>
</li>
</ul>
<h3 id="starscope-v005">StarScope v0.0.5</h3>
<ul>
<li>Fixed issue that no report generated if there are too few cells left after filtering by nFeature &gt;= 200</li>
</ul>
<h3 id="starscope-v003-v004">StarScope v0.0.3, v0.0.4</h3>
<ul>
<li>
<p>Set thunderbio data running parameters as defaults instead of 10x parameters</p>
</li>
<li>
<p>Added whitelists for thunderbio V2, 10x V2 and V3</p>
</li>
<li>
<p>Fixed nextflow default path issue</p>
</li>
<li>
<p>Fixed conda env name issue</p>
</li>
<li>
<p>Implemented docker container running environment</p>
</li>
<li>
<p>Added a new script for user to generate 10x compatible STAR reference</p>
</li>
</ul>
<h3 id="starscope-v002">StarScope v0.0.2</h3>
<ul>
<li>
<p>Implemented <code>mkref</code> command</p>
</li>
<li>
<p>Added output section for README</p>
</li>
</ul>
<h3 id="starscope-v001">StarScope v0.0.1</h3>
<ul>
<li>
<p>Implemented <code>run</code> command</p>
</li>
<li>
<p>Added running env checking procedure</p>
</li>
</ul>
</div>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Hugo Relearn Theme</h1>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">Chapter 1</div>

<h1 id="basics">Basics</h1>

<p>Instruction of the workflows.</p>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Subsections of Basics</h1>
          <article class="default">
            <header class="headline">
            </header>

<h1 id="installation">Installation</h1>

<h2 id="requirements">Requirements</h2>
<ul>
<li>Java 11 or higher</li>
<li>Nextflow</li>
<li>Conda/miniconda</li>
<li>Docker</li>
</ul>
<h3 id="java">Java</h3>
<p>Nextflow will need java 11 or higher to be installed. The recommanded way to install
java is through <a href="https://sdkman.io/" rel="external" target="_self">SDKMAN</a>. Please use the command below:</p>
<p>Install SDKMAN:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>curl -s https://get.sdkman.io | bash</code></pre></div><p>Open a new terminal and install Java</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>sdk install java 17.0.10-tem</code></pre></div><p>Check java installation and comfirm it&rsquo;s version</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>java -version</code></pre></div><h3 id="nextflow">Nextflow</h3>
<p>Nextflow binary was included in the StarScope directory.</p>
<h3 id="condaminiconda">Conda/miniconda</h3>
<p>We usually use <a href="https://github.com/conda-forge/miniforge" rel="external" target="_self">miniforge&rsquo;s conda distro</a>, use could
also install via conda official installer, or use mamba directoryly, which is much faster.</p>
<p>Miniforge:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>wget -c https://github.com/conda-forge/miniforge/releases/download/24.3.0-0/Mambaforge-24.3.0-0-Linux-x86_64.sh
bash Mambaforge-24.3.0-0-Linux-x86_64.sh</code></pre></div><p>Official minicoda:</p>
<div class="highlight wrap-code"><pre tabindex="0"><code>wget -c wget -c https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh</code></pre></div><p>Micromamba, user may need to put micromamba binary into $PATH</p>
<div class="highlight wrap-code"><pre tabindex="0"><code># Linux Intel (x86_64):
curl -Ls https://micro.mamba.pm/api/micromamba/linux-64/latest | tar -xvj bin/micromamba</code></pre></div>
            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">Chapter 2</div>

<h1 id="gex-module-for-scrna-seq">gex module for scRNA-seq</h1>

<p>Chapter homepage for gex workflow.</p>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">Chapter 3</div>

<h1 id="vdj-module-for-immune-repertoire-analysis">VDJ Module for Immune Repertoire Analysis</h1>

<p>Chapter homepage for vdj module.</p>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
            <header class="headline">
            </header>
<div class="article-subheading">Chapter 4</div>

<h1 id="atac-module-for-scatac-seq-data">ATAC Module for scATAC-seq Data</h1>

<p>Chapter homepage for atac module.</p>

            <footer class="footline">
            </footer>
          </article>

          </section>
        </div>
      </main>
    </div>
    <script src="./js/clipboard.min.js?1714963182" defer></script>
    <script src="./js/perfect-scrollbar.min.js?1714963182" defer></script>
    <script src="./js/theme.js?1714963182" defer></script>
  </body>
</html>
